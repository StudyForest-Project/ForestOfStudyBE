components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: study_{studyId}
      description: ìŠ¤í„°ë”” ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í›„ ë°œê¸‰ë˜ëŠ” ì¿ í‚¤

  schemas:
    # ì˜¤ëŠ˜ì˜ ìŠµê´€ ëª©ë¡ ì‘ë‹µ
    TodayHabitsResponse:
      type: object
      properties:
        today:
          type: string
          example: '2026-02-02'
        now:
          type: string
          example: '2026-02-02T14:30:00+09:00'
        habits:
          type: array
          items:
            type: object
            properties:
              habitId:
                type: string
                example: 01HAAB...
              title:
                type: string
                example: ìš´ë™í•˜ê¸°
              checked:
                type: boolean
                example: true

    # ìŠµê´€ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ì‘ë‹µ
    HabitResponse:
      type: object
      properties:
        habit:
          type: object
          properties:
            id:
              type: string
              example: 01HAAB...
            studyId:
              type: string
              example: 01KFZ1K63J37VSVNBYC61TJ54V
            title:
              type: string
              example: ìš´ë™í•˜ê¸°
            startDate:
              type: string
              format: date-time
              example: '2026-02-02T00:00:00.000Z'
            endDate:
              type: string
              format: date-time
              nullable: true
              example: null
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    # ìŠµê´€ ì‚­ì œ ì‘ë‹µ
    HabitDeleteResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        habit:
          $ref: '#/components/schemas/HabitResponse/properties/habit'

    # ìŠµê´€ í† ê¸€ ì‘ë‹µ
    HabitToggleResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        habit:
          type: object
          properties:
            id:
              type: string
              example: 01HAAB...
            habitId:
              type: string
              example: 01HAAB...
            logDate:
              type: string
              format: date-time
              example: '2026-02-02T00:00:00.000Z'
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    # ì—ëŸ¬ ì‘ë‹µ
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            status:
              type: integer
              example: 400
            code:
              type: string
              example: NOT_FOUND
            message:
              type: string
              example: í• ì¼ ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

    # Validation ì—ëŸ¬ ì‘ë‹µ
    ValidationErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            status:
              type: integer
              example: 400
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: í• ì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.

paths:
  /studies/{studyId}/today-habits:
    get:
      summary: ì˜¤ëŠ˜ì˜ ìŠµê´€ ëª©ë¡ ì¡°íšŒ
      description: ìŠ¤í„°ë””ì˜ ì˜¤ëŠ˜ ìŠµê´€ ëª©ë¡ê³¼ ì²´í¬ ìƒíƒœë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í•„ìš” ğŸ”’)
      tags: [Habits]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: studyId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠ¤í„°ë”” ID (ULID í˜•ì‹, 26ì)
          example: 01KFZ1K63J37VSVNBYC61TJ54V
      responses:
        200:
          description: ìŠµê´€ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodayHabitsResponse'
        401:
          description: ì¸ì¦ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¯¸ê²€ì¦)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 401
                  code: UNAUTHORIZED
                  message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤
        404:
          description: ìŠ¤í„°ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 404
                  code: NOT_FOUND
                  message: í• ì¼ ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

  /studies/{studyId}/habits:
    post:
      summary: ìŠµê´€ ìƒì„±
      description: ìƒˆë¡œìš´ ìŠµê´€ì„ ìƒì„±í•©ë‹ˆë‹¤. (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í•„ìš” ğŸ”’)
      tags: [Habits]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: studyId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠ¤í„°ë”” ID (ULID í˜•ì‹, 26ì)
          example: 01KFZ1K63J37VSVNBYC61TJ54V
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  example: ìš´ë™í•˜ê¸°
                  description: ìŠµê´€ ì´ë¦„
      responses:
        201:
          description: ìŠµê´€ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        400:
          description: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                titleRequired:
                  summary: ì œëª© ë¯¸ì…ë ¥
                  value:
                    error:
                      status: 400
                      code: VALIDATION_ERROR
                      message: í• ì¼ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.
                titleEmpty:
                  summary: ì œëª© ë¹ˆê°’
                  value:
                    error:
                      status: 400
                      code: VALIDATION_ERROR
                      message: í• ì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                invalidId:
                  summary: ì˜ëª»ëœ ID í˜•ì‹
                  value:
                    error:
                      status: 400
                      code: BAD_REQUEST
                      message: ì˜ëª»ëœ ID í˜•ì‹ì…ë‹ˆë‹¤
        401:
          description: ì¸ì¦ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¯¸ê²€ì¦)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 401
                  code: UNAUTHORIZED
                  message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤

  /studies/{studyId}/habits/{habitId}:
    patch:
      summary: ìŠµê´€ ìˆ˜ì •
      description: ê¸°ì¡´ ìŠµê´€ì„ ìˆ˜ì •í•©ë‹ˆë‹¤. (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í•„ìš” ğŸ”’)
      tags: [Habits]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: studyId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠ¤í„°ë”” ID (ULID í˜•ì‹, 26ì)
          example: 01KFZ1K63J37VSVNBYC61TJ54V
        - in: path
          name: habitId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠµê´€ ID (ULID í˜•ì‹, 26ì)
          example: 01HAAB123456789012345678
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: ë…ì„œí•˜ê¸°
                  description: ìŠµê´€ ì´ë¦„
      responses:
        200:
          description: ìŠµê´€ ìˆ˜ì • ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        400:
          description: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                titleEmpty:
                  summary: ì œëª© ë¹ˆê°’
                  value:
                    error:
                      status: 400
                      code: VALIDATION_ERROR
                      message: í• ì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                noField:
                  summary: ìˆ˜ì •í•  í•­ëª© ì—†ìŒ
                  value:
                    error:
                      status: 400
                      code: VALIDATION_ERROR
                      message: ìˆ˜ì •í•  í•­ëª©ì„ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.
                invalidId:
                  summary: ì˜ëª»ëœ ID í˜•ì‹
                  value:
                    error:
                      status: 400
                      code: BAD_REQUEST
                      message: ì˜ëª»ëœ ID í˜•ì‹ì…ë‹ˆë‹¤
        401:
          description: ì¸ì¦ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¯¸ê²€ì¦)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 401
                  code: UNAUTHORIZED
                  message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤
        404:
          description: ìŠµê´€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 404
                  code: NOT_FOUND
                  message: ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

    delete:
      summary: ìŠµê´€ ì‚­ì œ (Soft Delete)
      description: ìŠµê´€ì„ ì‚­ì œí•©ë‹ˆë‹¤. ì‹¤ì œ ì‚­ì œê°€ ì•„ë‹Œ endDateë¥¼ ì„¤ì •í•˜ëŠ” Soft Deleteì…ë‹ˆë‹¤. (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í•„ìš” ğŸ”’)
      tags: [Habits]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: studyId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠ¤í„°ë”” ID (ULID í˜•ì‹, 26ì)
          example: 01KFZ1K63J37VSVNBYC61TJ54V
        - in: path
          name: habitId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠµê´€ ID (ULID í˜•ì‹, 26ì)
          example: 01HAAB123456789012345678
      responses:
        200:
          description: ìŠµê´€ ì‚­ì œ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitDeleteResponse'
        400:
          description: ì˜ëª»ëœ ID í˜•ì‹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 400
                  code: BAD_REQUEST
                  message: ì˜ëª»ëœ ID í˜•ì‹ì…ë‹ˆë‹¤
        401:
          description: ì¸ì¦ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¯¸ê²€ì¦)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 401
                  code: UNAUTHORIZED
                  message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤
        404:
          description: ìŠµê´€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 404
                  code: NOT_FOUND
                  message: ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

  /studies/{studyId}/habits/{habitId}/toggle:
    post:
      summary: ìŠµê´€ ì²´í¬ í† ê¸€
      description: ì˜¤ëŠ˜ ë‚ ì§œì˜ ìŠµê´€ ì²´í¬ ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤. checkedê°€ trueë©´ ë¡œê·¸ ìƒì„±, falseë©´ ë¡œê·¸ ì‚­ì œ. (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í•„ìš” ğŸ”’)
      tags: [Habits]
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: studyId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠ¤í„°ë”” ID (ULID í˜•ì‹, 26ì)
          example: 01KFZ1K63J37VSVNBYC61TJ54V
        - in: path
          name: habitId
          required: true
          schema:
            type: string
            pattern: '^[0-9A-Z]{26}$'
          description: ìŠµê´€ ID (ULID í˜•ì‹, 26ì)
          example: 01HAAB123456789012345678
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - checked
              properties:
                checked:
                  type: boolean
                  example: true
                  description: ì²´í¬ ìƒíƒœ (true = ì™„ë£Œ, false = ë¯¸ì™„ë£Œ)
      responses:
        200:
          description: í† ê¸€ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitToggleResponse'
              examples:
                checked:
                  summary: ì²´í¬ ì™„ë£Œ (ë¡œê·¸ ìƒì„±)
                  value:
                    success: true
                    habit:
                      id: 01HAAB...
                      habitId: 01HAAB...
                      logDate: '2026-02-02T00:00:00.000Z'
                      createdAt: '2026-02-02T05:30:00.000Z'
                      updatedAt: '2026-02-02T05:30:00.000Z'
                unchecked:
                  summary: ì²´í¬ í•´ì œ (ë¡œê·¸ ì‚­ì œ)
                  value:
                    success: true
                    habit:
                      count: 1
        400:
          description: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                checkedRequired:
                  summary: checked ë¯¸ì…ë ¥ ë˜ëŠ” ì˜ëª»ëœ íƒ€ì…
                  value:
                    error:
                      status: 400
                      code: VALIDATION_ERROR
                      message: checkedë¥¼ ë¸”ë¦¬ì–¸íƒ€ì…ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”
                invalidId:
                  summary: ì˜ëª»ëœ ID í˜•ì‹
                  value:
                    error:
                      status: 400
                      code: BAD_REQUEST
                      message: ì˜ëª»ëœ ID í˜•ì‹ì…ë‹ˆë‹¤
        401:
          description: ì¸ì¦ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¯¸ê²€ì¦)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  status: 401
                  code: UNAUTHORIZED
                  message: ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤
